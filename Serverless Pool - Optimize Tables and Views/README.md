# Optimze Tables and Views

The provided scripts will auto create and run the DDL that gets generated by reading in the max data lengths for string columns. Without this script, views and external tables get a data type of max for all string type column. This causes poor performance when quering with Synapse serverless.

External table creation and view creation are seperated into their own scripts. The logic between the two is very similiar though. The external tables script will take in exsting external tables and create new external tables with an appended '_OPTIMIZED' string in the table name. The view script takes in a list of view name and folder locations that each view will point to.

The scripts will:
  1. Create a temp view.
  2. Read the columns and data types from that view.
  3. Pivot the data and create a select statement that runs to get the max value for string data types.
  4. Unpivot the results from above and join to the temp view columns to get the optimal data types.
  5. Pivot the results again so we can create the target DDL that is used to create the views and tables.
  6. DDL for stat creation is also included but does not execute as part of the script since stat creation can take a long time to execute depending on data size. These should be executed in a seperate session and trimmed down to only the column used in the queries.

Things that the script handles for you:
  1. Runs a query to get the max length of each string column and uses length for character length of the data type.
  2. Adds the 'COLLATE Latin1_General_100_BIN2_UTF8' syntax to all the string columns.
  3. Executes the generated DDL from steps 1 and 2 to create a new table/view with "_OPTIMIZED" appended to the table/view name.
  4. Gives you the DDL to create stats on all the columns of the tables.From there you can cherry pick which columns you want to actually create statistics on.
